<as-split direction="vertical" unit="pixel" gutterSize="0">
  <as-split-area class="flex-fixed" [size]="40">
    <div style="padding: 5px;background-color: white;margin: 10px 5px;">
      <div nz-row style=" border:1px solid #a1a0a0;padding-top: 5px;padding-bottom: 5px;">
        <div nz-col>
          <div style="margin-left: 40px;" nz-row nzJustify="space-between">
            <div nzSpan="3" nz-col>
              <!-- <button nz-button nzType="primary" (click)="clickFold()">
              <i nz-icon nzType="up" nzTheme="outline" *ngIf="!isFold"></i>
              <i nz-icon nzType="down" nzTheme="outline" *ngIf="isFold"></i>
            </button> -->
              <button nzTooltipPlacement="bottom" nz-button nz-tooltip nzType="link" nzSize="large"
                style='margin-top: -4px;margin-bottom: -4px;' (click)="clickFold()">
                <i nz-icon [nzType]="isFold? 'down-circle' : 'up-circle'" nzTheme="twotone"></i></button>
              <font style="font-size:18px;color:#3399f7"> 整改问题名称</font>
            </div>
            <div nzSpan="2" nz-col style='margin-top: 5px;font-size:18px'>整改反馈进度:</div>
            <div nzSpan="4" nz-col style='margin-top: 4px; margin-left:-12px'>
              <nz-progress nzSize="small" [nzPercent]="50" nzStatus="active"></nz-progress>
            </div>
            <div nzSpan="14" nz-col *ngIf="isRectify" style="margin-left: 14px;">
              <div style="position: absolute;right: 0px;"> &nbsp;
                <button nz-button nzType="primary" (click)="rectifySwitch()">切换问题</button>
                <button nz-button nzType="primary" (click)="applicationExtension()"><i nz-icon
                    nzType="exclamation-circle" nzTheme="outline" style='color: red;'></i>申请延期</button>
                <button nz-button nzType="primary" (click)="applicationRecord()">延期申请记录</button>
              </div>
            </div>
            <div nzSpan="14" nz-col *ngIf="!isRectify" style="margin-left: 14px;">
              <div style="position: absolute;right: 0px;">
                &nbsp;
                <button nz-button nzType="primary" (click)="rectifyFeedbackRemind()">反馈提醒</button>
                <button nz-button nzType="primary" (click)="goRectifyEffect()">整改成效</button>
                <button nz-button nzType="danger" nzDanger (click)="transfer(false)"
                  [disabled]="'未移交'===rectifyTrack.transferStatus">移交纪检</button>
                <!-- <button nz-button nzType="danger" nzDanger (click)="transfer(true)"
                  [disabled]="'已移交'===rectifyTrack.transferStatus">查看移交结果</button> -->
                <button nz-button nzType="primary" (click)="rectifySwitch()">切换问题</button>
                <button nz-button nzType="primary" (click)="delayExtension()"><i nz-icon nzType="exclamation-circle"
                    nzTheme="outline" style='color: red;'></i>延期审批</button>
                <button nz-button nzType="primary" (click)="delayApprove()">延期审批记录</button>
                <nz-popconfirm [nzTitle]="confirmtittle" (nzOnConfirm)="onChangeStates(rectifyTrack.id)"
                  style="margin-right: 6px;">
                  <ng-template #confirmtittle>
                    <font color='red'>结束整改如果有子问题，那么所有子问题都会结束整改</font>
                    <br />
                    <font color='red'> 确定结束整改？</font>
                  </ng-template>
                  <button nz-button nzType="primary" nz-popconfirm>结束整改</button>
                </nz-popconfirm>
              </div>
            </div>
          </div>
          <div nz-row style="margin-top:20px" *ngIf="!isFold">
            <form nz-form>
              <nz-form-item>
                <nz-form-label nzSpan="2">整改部门</nz-form-label>
                <nz-form-control nzSpan="5">
                  <nz-tree-select [nzNodes]="organizationTree" [nzAllowClear]="true" nzDefaultExpandAll nzShowSearch
                    name="rectifyDepartmentId" [(ngModel)]="rectifyTrack.rectifyDepartment.id"
                    [nzDropdownStyle]="{ maxHeight: '280px' }" disabled>
                  </nz-tree-select>
                </nz-form-control>
                <nz-form-control nzSpan="1"></nz-form-control>
                <nz-form-label nzSpan="2">整改负责人</nz-form-label>
                <nz-form-control nzSpan="5">
                  <input nz-input readonly name='整改负责人' readonly [(ngModel)]="rectifyTrack.dutyUser.name" />
                </nz-form-control>
                <nz-form-control nzSpan="1"></nz-form-control>
                <nz-form-label nzSpan="2">问题类型</nz-form-label>
                <nz-form-control nzSpan="5">
                  <app-dict-select [dictCode]="'PROBLEM_TYPE'" nzAllowClear name="problemType" [disabled]='true'
                    [(ngModel)]="rectifyTrack.type">
                  </app-dict-select>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzSpan="2">整改截止日期</nz-form-label>
                <nz-form-control nzSpan="5">
                  <nz-date-picker [(ngModel)]="date" name="rectifyEndTime" disabled></nz-date-picker>
                </nz-form-control>
                <nz-form-control nzSpan="1"></nz-form-control>
                <nz-form-label nzSpan="2">涉及金额(元)</nz-form-label>
                <nz-form-control nzSpan="5">
                  <input nz-input readonly name='issueMoney' readonly ngModel="100000" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzSpan="2">审计报告</nz-form-label>
                <nz-form-control nzSpan="21"><input nz-input readonly [(ngModel)]="rectifyTrack.source" name="source" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzSpan="2">问题描述</nz-form-label>
                <nz-form-control nzSpan="21"><textarea rows="3" nz-input readonly [(ngModel)]="rectifyTrack.remark"
                    name="remark"></textarea> </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzSpan="2">审计建议</nz-form-label>
                <nz-form-control nzSpan="21"> <textarea rows="3" nz-input readonly [(ngModel)]="rectifyTrack.advice"
                    name="advice"></textarea></nz-form-control>
              </nz-form-item>
              <nz-form-item *ngIf="isRectify">
                <nz-form-label nzSpan="2">整改要求</nz-form-label>
                <nz-form-control nzSpan="21"><textarea rows="3" nz-input readonly name="整改要求"></textarea>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-item>
                  <nz-form-label nzSpan="2">是否无法整改</nz-form-label>
                  <nz-form-control nzSpan="21">
                    <nz-radio-group name="radioValue" [(ngModel)]="radioValue">
                      <label nz-radio [nzValue]="false">否</label>
                      <label nz-radio [nzValue]="true">是</label>
                    </nz-radio-group>
                    <button nz-button nzType="primary" style='float: right;' *ngIf='radioValue'>保存</button>
                  </nz-form-control>
                </nz-form-item>
              </nz-form-item>
              <div *ngIf="radioValue">
                <nz-form-item>
                  <nz-form-label nzSpan="2">无法整改原因</nz-form-label>
                  <nz-form-control nzSpan="21"> <textarea rows="3" nz-input name="advice"></textarea></nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzSpan="2">无法整改说明材料</nz-form-label>
                  <nz-form-control nzSpan="21">
                    <app-attach-list [show]="true" [(attachFiles)]="systemFiles" #attachListComponent
                      [fileType]="'RECTIFY_MEASURE_FILE'">
                    </app-attach-list>
                  </nz-form-control>
                </nz-form-item>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </as-split-area>

  <as-split-area [size]="'*'">
    <as-split direction="horizontal" unit="percent" [useTransition]="true" gutterSize="2" style="padding: 0 5px;">
      <as-split-area [size]="leftSize" style="background-color: white; padding-top: 5px;">
        <as-split direction="vertical" unit="pixel" gutterSize="0">
          <as-split-area class="flex-fixed" [size]="40">
            <div style="padding-bottom: 3px; padding-left: 45px; margin-top: 2px;">
              <font style="color:#0000FF; font-size: 18px;">整改跟踪时间轴</font>
            </div>
            <div style="padding: 0 5px;">
              <nz-divider></nz-divider>
            </div>
          </as-split-area>
          <as-split-area [size]="'*'">
            <div style="height: 100%;width: 100%;">
              <app-rectify-time-line #rectifyTimeLineComponent></app-rectify-time-line>
            </div>
          </as-split-area>
        </as-split>
      </as-split-area>
      <as-split-area [size]="rightSize">
        <as-split direction="vertical" unit="pixel" gutterSize="0" style="background-color: white; padding-top:5px ;">
          <as-split-area class="flex-fixed" [size]="40">
            <div nz-col>
              <div nz-row>
                <div nz-col nzSpan="20" [ngStyle]="{'padding-left':timeLineButtonType === 'right' ? '45px' : '25px'}">
                  <!-- <button nz-button nzType="link" style="float: inherit;" (click)="hideTimeLine()"><i nz-icon
                      [nzType]="timeLineButtonType" nzTheme="outline"></i></button> -->
                  <button nzTooltipPlacement="bottom" nz-button nz-tooltip nzType="link" nzSize="large"
                    style="float: inherit; margin-top: -4px; margin-bottom: -4px;" (click)="hideTimeLine()">
                    <i nz-icon [nzType]="leftSize === 0 ? 'right-circle' : 'left-circle'"
                      nzTheme="twotone"></i></button>
                  <div [ngStyle]="{'margin-top': '2px'}">
                    <font style="color:#0000FF; font-size: 18px; text-align: center;" *ngIf="!isRectify">整改反馈情况</font>
                    <font style="color:#0000FF; font-size: 18px; text-align: center;" *ngIf="isRectify">整改详情</font>
                  </div>
                </div>
                <div nz-col nzSpan="3">
                  <div [ngStyle]="{'position': 'absolute','right':timeLineButtonType === 'right' ? '10px' : '20px'}">
                    <button nz-button nzType="primary" (click)="openRectifyDiaryComponent()"
                      *ngIf="!isRectify">工作备忘录</button>

                  </div>
                  <div [ngStyle]="{'position': 'absolute','right':timeLineButtonType === 'right' ? '10px' : '20px'}">
                    <button nz-button nzType="primary" (click)="update()" *ngIf="isRectify">新增措施</button>
                  </div>
                </div>
                <div nz-col nzSpan="1"></div>
              </div>
            </div>
            <div style="padding: 0 5px;">
              <nz-divider></nz-divider>
            </div>
            <div nz-col *ngIf="!isRectify">
              <div nz-row>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nzSpan="8">整改截止时间</nz-form-label>
                    <nz-form-control nzSpan="16">
                      <nz-date-picker [(ngModel)]="rectifyEndTime" (ngModelChange)="onChangeRectifyEndTime($event)">
                      </nz-date-picker>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-item>
                    <nz-form-label nzSpan="8">整改反馈频率</nz-form-label>
                    <nz-form-control nzSpan="16">
                      <nz-input-number style="width:50%" [(ngModel)]="demoValue" [nzMin]="0" [nzStep]="1">
                      </nz-input-number>
                      <nz-select style="width:50%" [(ngModel)]="rectifyBackFeedHzUnit" [nzAllowClear]="true">
                        <nz-option nzValue="day" nzLabel="日"></nz-option>
                        <nz-option nzValue="week" nzLabel="周"></nz-option>
                        <nz-option nzValue="month" nzLabel="月"></nz-option>
                        <nz-option nzValue="year" nzLabel="年"></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="7">
                  <nz-form-label nzSpan="8">到期前几天自动发送</nz-form-label>
                  <nz-form-control nzSpan="16">
                    <nz-input-number [(ngModel)]="demoValue" [nzMin]="0" [nzStep]="1" [nzPrecision]="0">
                    </nz-input-number>
                  </nz-form-control>
                </div>

                <div nz-col nzSpan="2">
                  <div [ngStyle]="{'position': 'absolute','right':timeLineButtonType === 'right' ? '10px' : '20px'}">
                    <button nz-button nzType="primary" (click)="saveProblem()">保存</button>
                  </div>
                </div>
                <div nz-col nzSpan="1"></div>
              </div>
            </div>
            <div nz-row *ngIf="!isRectify">
              <div nz-col nzSpan="7">
                <nz-form-label nzSpan="8">自动催办通知模板</nz-form-label>
                <nz-form-control nzSpan="16">
                  <nz-tree-select style="width: 100%" [nzNodes]="nodes" nzShowSearch nzDefaultExpandAll
                    [(ngModel)]="templateValue" (ngModelChange)="templateChange($event)">
                  </nz-tree-select>
                </nz-form-control>
              </div>
              <div nz-col nzSpan="7"></div>
              <div nz-col nzSpan="7"></div>
              <div nz-col nzSpan="2">
                <div [ngStyle]="{'position': 'absolute','right':timeLineButtonType === 'right' ? '10px' : '20px'}">
                  <button nz-button nzType="default" (click)="clear()">清除</button>
                </div>
              </div>
              <div nz-col nzSpan="1"></div>
            </div>
          </as-split-area>

          <as-split-area [size]="'*'">
            <div style="height:100%">
              <nz-table #nzTable [nzData]="listOfData" [nzScroll]="{ x: '1500px', y: '240px' }" [nzLoading]="loading"
                [nzTotal]="pageInfo.totalRecords" [nzPageSize]="pageInfo.pageSize" [nzPageIndex]="pageInfo.pageNo"
                [nzSize]="'small'" nzShowSizeChanger [nzShowTotal]="totalTemplate"
                (nzPageSizeChange)="pageSizeChange($event)" (nzPageIndexChange)="pageIndexChange($event)"
                [nzShowQuickJumper]="true" [nzFrontPagination]="false" [nzPageSizeOptions]="[20, 35, 50, 100]"
                nzBordered="true">
                <ng-template #totalTemplate let-total> 共 {{ pageInfo.totalRecords }} 条 </ng-template>
                <thead>
                  <tr>
                    <th nzShowExpand nzWidth="80px">按钮</th>
                    <th nzWidth="90px" [nzAlign]="'center'">措施状态</th>
                    <th nzWidth="200px">措施类型</th>
                    <th>整改措施</th>
                    <th nzWidth="200px">整改进度</th>
                    <th nzWidth="100px" [nzAlign]="'center'">附件</th>
                    <th nzWidth="200px" [nzAlign]="'center'">拟整改时间</th>
                    <!-- <th nzWidth="140px" [nzAlign]="'center'" *ngIf="!isRectify">整改截止时间</th> -->
                    <th nzWidth="80px" [nzAlign]="'center'">剩余天数</th>
                    <th nzWidth="180px" [nzAlign]="'center'" *ngIf="!isRectify">整改结果</th>
                    <th nzWidth="180px" [nzAlign]="'center'" *ngIf="isRectify">操作</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-template ngFor let-data [ngForOf]="nzTable.data">
                    <tr>
                      <td nzWidth="80px" nzShowExpand [(nzExpand)]="mapOfExpandData[data.id]"
                        (nzExpandChange)="changeReadStates(data)">
                        <nz-badge [nzCount]="data.notReadNum" *ngIf="data.notReadNum !== 0">
                          <font style="color:white;">''</font>
                        </nz-badge>
                      </td>
                      <td nzWidth="90px" [nzAlign]="'center'">
                        <nz-tag [nzColor]="'#2db7f5'" *ngIf="data.measureStatus === 'RECTIFY_CENTRE'">整改中</nz-tag>
                        <nz-tag [nzColor]="'#87d068'" *ngIf="data.measureStatus === 'COMPLETED'">已完成</nz-tag>
                        <nz-tag [nzColor]="'#FF4500'" *ngIf="data.measureStatus === 'OVERDUE'">已逾期</nz-tag>
                        <nz-tag [nzColor]="'#808080'" *ngIf="data.measureStatus === 'INVALID'">已失效</nz-tag>
                        <nz-tag [nzColor]="'#D3D3D3'" *ngIf="data.measureStatus === 'NOT_SUBMITTED'&&isRectify">未提交
                        </nz-tag>
                      </td>
                      <td>{{ data.measureType }}</td>
                      <td>{{ data.measureContent }}</td>
                      <td nzWidth="200px">
                        <div style="display: inline-block;width:120px">
                          <nz-progress [nzPercent]="data.rectifyProgress" nzSize="small" [nzShowInfo]="false"
                            [nzStrokeWidth]="10">
                          </nz-progress>
                        </div>
                        <div style="display: inline-block;width: 60px;">&nbsp; {{ data.rectifyProgress }}&nbsp;%</div>
                      </td>
                      <td nzWidth="100px" [nzAlign]="'center'">
                        <button nz-button nzType="link" [disabled]="data.systemFiles.length < 1"
                          (click)="update(data, true, true)">
                          查看文件
                        </button>
                      </td>
                      <td nzWidth="200px" [nzAlign]="'center'">{{ formatDateFun(data.rectifyCompleteTime) }} ~
                        2021-12-12</td>
                      <!-- <td nzWidth="140px" [nzAlign]="'center'" *ngIf="!isRectify">{{ formatDateFun(data.rectifyEndTime)
                        }}</td> -->
                      <td nzWidth="50px" [nzAlign]="'right'">10</td>

                      <td nzWidth="180px" [nzAlign]="'center'">
                        <div *ngIf="!isRectify">
                          <button nz-button nzType="link" [disabled]="data.measureStatus === 'COMPLETED'"
                            (click)="chageRectifyProgress(data.id, null, 'COMPLETED')" style="padding: 0;">
                            整改完成
                          </button>
                          <nz-divider nzType="vertical"></nz-divider>
                          <button nz-button nzType="link" [disabled]="data.measureStatus === 'COMPLETED'"
                            (click)="chageRectifyProgress(data.id, null, 'INVALID')" style="padding: 0;">
                            重新整改
                          </button>
                        </div>
                        <div *ngIf="isRectify">
                          <div *ngIf=" data.measureStatus === 'NOT_SUBMITTED'">
                            <a (click)="update(data)">编辑</a>
                            <nz-divider nzType="vertical"></nz-divider>
                            <nz-popconfirm [nzTitle]="confirmtittle" (nzOnConfirm)="delete(data)">
                              <ng-template #confirmtittle>是否要删除该条数据</ng-template>
                              <a nz-popconfirm>删除</a>
                            </nz-popconfirm>
                            <nz-divider nzType="vertical"></nz-divider>
                            <a (click)="chageRectifyProgress(data.id, null, 'RECTIFY_CENTRE')">提交</a>
                          </div>
                          <div *ngIf="data.measureStatus === 'RECTIFY_CENTRE'">
                            <a (click)="watch(data)" *ngIf="data.measureStatus !== 'NOT_SUBMITTED'">查看</a>
                            <nz-divider nzType="vertical"
                              *ngIf="data.measureStatus !== 'NOT_SUBMITTED'&&data.measureStatus === 'RECTIFY_CENTRE'">
                            </nz-divider>
                            <a (click)="update(data, true, false)">上传</a>
                            <nz-divider nzType="vertical"></nz-divider>
                            <a (click)="chageRectifyProgress(data.id, null, 'INVALID')">失效</a>
                          </div>
                        </div>

                      </td>
                    </tr>
                    <tr [nzExpand]="mapOfExpandData[data.id]">
                      <td></td>
                      <td colspan="8">
                        <div *ngIf="data.rectifyMeasureReplys && data.rectifyMeasureReplys.length > 0">
                          <div *ngFor="let rectifyMeasureReply of data.rectifyMeasureReplys; let i = index">
                            <div style="color:silver">{{ rectifyMeasureReply.createdTime }}</div>
                            <!-- <div>{{rectifyMeasureReply.roles[0].name}}</div> -->
                            <div style="font-weight: 500;font-size: 18px;">{{
                              rectifyMeasureReply.replyContent }}</div>
                            <div *ngIf="i === 0">
                              <button nz-button nzType="link" *ngIf="isRectifyMeasureReply"
                                (click)="rectifyMeasureReplyClick(data.id)">回复</button>
                              <div *ngIf="!isRectifyMeasureReply" style="margin:5px;">
                                <app-rectify-measure-reply #rectifyMeasureReplyComponent
                                  (saveRectifyMeasureReply)="loadData()"
                                  (rectifyMeasureReplyBoolean)="clickRectifyMeasureReply()">
                                </app-rectify-measure-reply>
                              </div>

                            </div>
                          </div>
                        </div>

                        <div *ngIf="!data.rectifyMeasureReplys || data.rectifyMeasureReplys.length < 1">
                          <div class="gutter-example">
                            <div>
                              <font style="color:silver">李明 2021-10-25</font>
                              <button nz-button nzType="link" (click)="lookFile(data.systemFiles)">查看文件</button>
                            </div>
                            <div style="font-weight: 500;font-size: 18px;">关于xxx整改措施补充</div>
                            <button nz-button nzType="link" *ngIf="isRectifyMeasureReply"
                              (click)="rectifyMeasureReplyClick(data.id)"
                              [disabled]="data.measureStatus === 'NOT_SUBMITTED'">回复</button>
                            <div *ngIf="!isRectifyMeasureReply" style="margin:5px;">
                              <app-rectify-measure-reply #rectifyMeasureReplyComponent
                                (saveRectifyMeasureReply)="loadData()"
                                (rectifyMeasureReplyBoolean)="clickRectifyMeasureReply()">
                              </app-rectify-measure-reply>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </ng-template>
                </tbody>
              </nz-table>
            </div>
          </as-split-area>
        </as-split>
      </as-split-area>
    </as-split>
  </as-split-area>
</as-split>

<!-- 备忘录 -->
<app-rectify-diary #rectifyDiaryComponent></app-rectify-diary>
<!-- 整改措施 -->
<app-rectify-measure #rectifyMeasureComponent (saveRectifyMeasure)="loadData()"></app-rectify-measure>
<!-- 整改措施回复 -->


<!-- 整改部门提交申请请求
  调用弹窗组件 -->
<app-rectify-workbeach-put #rectifyWorkbeachPutComponent [isRectify]="isRectify"></app-rectify-workbeach-put>

<rectify-workbeach-table #rectifyWorkbeachTableComponent></rectify-workbeach-table>
<!-- 移交纪检 -->
<app-rectify-issue-transfer #rectifyIssueTransferComponent></app-rectify-issue-transfer>
<!-- 整改成效 -->
<app-rectify-effect #rectifyEffectComponent></app-rectify-effect>
<!-- 整改问题切换 -->
<app-rectify-problem-switch #rectifyProblemSwitchComponent (rectifyProblem)="chageRectify($event)">
</app-rectify-problem-switch>

<!-- 反馈提醒组件 -->
<app-rectify-feedback-remind #rectifyFeedbackRemindComponent></app-rectify-feedback-remind>