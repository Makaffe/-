<nz-table #expandTable [nzData]="listOfMapData" [nzScroll]="{ x: '1150px',y: '100%' }" [nzLoading]="loading"
  [nzTotal]="pageInfo.totalRecords" [nzPageSize]="pageInfo.pageSize" [nzPageIndex]="pageInfo.pageNo" [nzSize]="'small'"
  nzShowSizeChanger [nzShowTotal]="totalTemplate" (nzPageSizeChange)="pageSizeChange($event)"
  (nzPageIndexChange)="pageIndexChange($event)" [nzShowQuickJumper]="true" [nzFrontPagination]="false"
  [nzPageSizeOptions]="[20, 35, 50, 100]" nzBordered="true">
  <ng-template #totalTemplate let-total> 共 {{ pageInfo.totalRecords }} 条 </ng-template>
  <thead>
    <tr>
      <th nzWidth="50px"></th>
      <th nzWidth="120px">序号</th>
      <th nzWidth="100px" nzAlign="center">状态</th>
      <th nzWidth="100px" nzAlign="center">移交状态</th>
      <th nzWidth="170px">审计报告名称</th>
      <th nzWidth="150px">问题名称</th>
      <th nzWidth="150px">问题描述</th>
      <th nzWidth="150px">问题类型</th>
      <th nzWidth="150px">整改部门</th>
      <th nzWidth="150px">整改负责人</th>
      <th nzWidth="150px">审计建议</th>
      <th nzWidth="150px">问题来源</th>
      <th nzWidth="150px">OA发送情况</th>
      <th nzWidth="150px" nzAlign="center" nzRight="0px">操作</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let data of expandTable.data; let i=index">
      <ng-container *ngFor="let item of mapOfExpandedData[data.id]; let ci=index">
        <tr *ngIf="(item.parent && item.parent.expand) || !item.parent">
          <td [nzShowCheckbox]="!item.children.length" [(nzChecked)]="mapOfCheckedId[item.id]"
            (nzCheckedChange)="checked(item,mapOfCheckedId[item.id])"></td>
          <td [nzIndentSize]="item.level * 20" [nzShowExpand]="!!(item.children && item.children.length > 0)"
            [(nzExpand)]="item.expand" (nzExpandChange)="collapse(mapOfExpandedData[data.id], item, $event)"
            *ngIf="item.level === 0">
            {{ item.level === 0?i+1:i+1 + '-' + ci }}
          </td>
          <td [nzIndentSize]="item.level * 20" *ngIf="item.level === 1">
            {{ item.level === 0?i+1:i+1 + '-' + ci }}
          </td>
          <td nzAlign="center">
            <nz-tag *ngIf="item.sendStatus === 'NOT_ISSUED'" [nzColor]="'#b30000'">未下发</nz-tag>
            <nz-tag *ngIf="item.sendStatus === 'TO_BE_RECTIFIED'" [nzColor]="'#008CEC'">待整改</nz-tag>
            <nz-tag *ngIf="item.sendStatus === 'RECTIFYING'" [nzColor]="'#e5e600'">整改中</nz-tag>
            <nz-tag *ngIf="item.sendStatus === 'FEEDBACK_OVERDUE'" [nzColor]="'#F76A00'">反馈逾期</nz-tag>
            <nz-tag *ngIf="item.sendStatus === 'RECTIFY_OVERDUE'" [nzColor]="'#F76A00'">整改逾期</nz-tag>
            <nz-tag *ngIf="item.sendStatus === 'COMPLETE'" [nzColor]="'#00cc00'">已完成</nz-tag>
          </td>
          <td nzAlign="center">
            <nz-tag *ngIf="item.transferStatus === 'NOT_HANDED_OVER'" [nzColor]="'#b30000'">未移交</nz-tag>
            <nz-tag *ngIf="item.transferStatus === 'HANDED_OVER'" [nzColor]="'#00cc00'">已移交</nz-tag>
          </td>
          <td>{{ item?.auditPost?.auditName }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.remark }}</td>
          <td>{{ this.convertProblemType(item.type) }}</td>
          <td>{{ item?.rectifyDepartment?.name }}</td>
          <td>{{ item?.dutyUser?.name }}</td>
          <td>{{ item.advice }}</td>
          <td>{{ item.source }}</td>
          <td>{{ item.oaSendCase?'已发送':'未发送' }}</td>
          <td nzRight="0px">
            <ng-container *ngIf="item.level === 0">
              <button nz-button nzType="link" (click)="splitIssue(item)" style="padding: 0px;">拆分</button>
            </ng-container>
            <nz-divider nzType="vertical" *ngIf="item.level === 0 && item.children.length === 0"></nz-divider>
            <ng-container *ngIf="item.children.length === 0">
              <button nz-button nzType="link" (click)="order([item])" [disabled]="item.sendStatus !== 'NOT_ISSUED'"
                style="padding: 0px;">下发</button>
              <nz-divider nzType="vertical"></nz-divider>
              <button nz-button nzType="link" (click)="transfer([item])"
                [disabled]="item.transferStatus !== 'NOT_HANDED_OVER'" style="padding: 0px;">移交</button>
            </ng-container>
          </td>
        </tr>
      </ng-container>
    </ng-container>
  </tbody>
</nz-table>
<!-- 问题拆分 -->
<app-rectify-issue-split #rectifyIssueSplitComponent (notification)="load()"></app-rectify-issue-split>
<!-- 移交纪检 -->
<app-rectify-issue-transfer #rectifyIssueTransferComponent (notification)="load()"></app-rectify-issue-transfer>
<!-- 问题下发 -->
<app-rectify-issue-order #rectifyIssueOrderComponent (notification)="load()"></app-rectify-issue-order>
