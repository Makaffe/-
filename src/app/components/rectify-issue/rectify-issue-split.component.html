<nz-modal [(nzVisible)]="isVisible" [nzTitle]="'问题拆分详情'" [nzMaskClosable]="false" (nzOnCancel)="handleCancel()"
  [nzFooter]="footer" [nzStyle]="{ top: '65px' }" nzWidth="1200" [nzBodyStyle]="{
    'min-height': '300px',
    'overflow-x': 'hidden',
    padding: '24px 24px 0 24px'
  }">

  <form nz-form>
    <nz-form-item>
      <nz-form-label nzSpan="2">问题名称</nz-form-label>
      <nz-form-control nzSpan="10">
        <input nz-input name="name" readonly [value]="problemItem?.name" />
      </nz-form-control>
      <nz-form-label nzSpan="2">问题类型</nz-form-label>
      <nz-form-control nzSpan="10">
        <input nz-input name="type" [value]="this.convertProblemType(problemItem?.type)" readonly />
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzSpan="2">问题描述</nz-form-label>
      <nz-form-control nzSpan="22">
        <textarea nz-input name="remark" [value]="problemItem?.remark" readonly></textarea>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzSpan="2">子问题</nz-form-label>
      <nz-form-control nzSpan="22">
        <nz-table #editRowTable nzBordered [nzData]="childrenProblemList" [nzScroll]="{ x: '1800px', y: '100%' }"
          [nzShowPagination]="false">
          <thead>
            <tr>
              <th nzWidth="50px" nzLeft="0px">序号</th>
              <th nzWidth="150px">子问题名称</th>
              <th nzWidth="200px">子问题描述</th>
              <th nzWidth="200px">子问题审计建议</th>
              <th nzWidth="100px">子问题类型</th>
              <th nzWidth="100px">子问题整改部门</th>
              <th nzWidth="100px">子问题整改负责人</th>
              <th nzWidth="120px" nzRight="0px" nzAlign="center">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of editRowTable.data; let i = index">
              <td nzLeft="0px">{{ i + 1 }}</td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else nameInputTpl">
                  {{ data.name }}
                </ng-container>
                <ng-template #nameInputTpl>
                  <input name="name" type="text" nz-input [(ngModel)]="editCache[data.uuid].data.name" />
                </ng-template>
              </td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else remarkInputTpl">
                  {{ data.remark }}
                </ng-container>
                <ng-template #remarkInputTpl>
                  <textarea name="remark" type="text" nz-input
                    [(ngModel)]="editCache[data.uuid].data.remark"></textarea>
                </ng-template>
              </td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else adviceInputTpl">
                  {{ data.advice }}
                </ng-container>
                <ng-template #adviceInputTpl>
                  <textarea name="advice" type="text" nz-input
                    [(ngModel)]="editCache[data.uuid].data.advice"></textarea>
                </ng-template>
              </td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else typeInputTpl">
                  {{ this.convertProblemType(data.type) }}
                </ng-container>
                <ng-template #typeInputTpl>
                  <nz-select name="type" [(ngModel)]="editCache[data.uuid].data.type" style="width: 100%;"
                    nzAllowClear="true" nzShowSearch="true">
                    <nz-option *ngFor="let option of problemTypeList" [nzLabel]="option.label" [nzValue]="option.value">
                    </nz-option>
                  </nz-select>
                </ng-template>
              </td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else rectifyDepartmentInputTpl">
                  {{ data?.rectifyDepartment?.name }}
                </ng-container>
                <ng-template #rectifyDepartmentInputTpl>
                  <nz-tree-select [nzNodes]="organizationTree" [nzAllowClear]="true" nzDefaultExpandAll nzShowSearch
                    name="rectifyDepartmentId" [(ngModel)]="editCache[data.uuid].data.rectifyDepartmentId"
                    [nzDropdownStyle]="{ maxHeight: '280px' }">
                  </nz-tree-select>
                </ng-template>
              </td>
              <td>
                <ng-container *ngIf="!editCache[data.uuid].edit; else dutyUserInputTpl">
                  {{ data?.dutyUser?.name }}
                </ng-container>
                <ng-template #dutyUserInputTpl>
                  <nz-select name="dutyUser" [(ngModel)]="editCache[data.uuid].data.dutyUserId" style="width: 100%;"
                    nzAllowClear="true" nzShowSearch="true">
                    <nz-option *ngFor="let option of dutyUserList" [nzLabel]="option.name" [nzValue]="option.id">
                    </nz-option>
                  </nz-select>
                </ng-template>
              </td>
              <td nzRight="0px" nzAlign="center">
                <div class="editable-row-operations">
                  <ng-container *ngIf="!editCache[data.uuid].edit; else saveTpl">
                    <a (click)="startEdit(data.uuid)">编辑</a>
                  </ng-container>
                  <ng-template #saveTpl>
                    <a (click)="saveEdit(data.uuid)">保存</a>
                    <nz-divider nzType="vertical"></nz-divider>
                    <a nz-popconfirm nzTitle="确定取消?" (nzOnConfirm)="cancelEdit(data.uuid)">取消</a>
                  </ng-template>
                </div>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-form-control>
    </nz-form-item>
  </form>
  <ng-template #footer>
    <button nz-button nzType="default" (click)="handleCancel()">取消</button>
    <button nz-button nzType="primary" (click)="addChildrenProblem()">新增</button>
    <button nz-button nzType="primary" [nzLoading]="loading" (click)="save()">
      确定
    </button>
  </ng-template>
</nz-modal>
