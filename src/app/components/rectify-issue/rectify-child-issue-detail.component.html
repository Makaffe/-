<nz-modal [(nzVisible)]="isVisible" [nzTitle]="'子问题详情'" [nzMaskClosable]="false" (nzOnCancel)="handleCancel()"
  [nzFooter]="formFooter" [nzStyle]="{ top: '65px' }" nzWidth="900" [nzBodyStyle]="{
    'overflow-y': 'auto',
    'overflow-x': 'hidden',
    padding: '24px'
  }">
  <form nz-form #form="ngForm">
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzFor="name" nzRequired>问题名称</nz-form-label>
      <nz-form-control [nzSpan]="20" [nzValidateStatus]="name.invalid && (name.dirty || name.touched) ? 'error' : ''">
        <input nz-input name="name" #name="ngModel" [(ngModel)]="currentItem.name" placeholder="问题名称" required />
        <nz-form-explain *ngIf="name.invalid && (name.dirty || name.touched)">
          请填写问题名称
        </nz-form-explain>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzFor="remark">问题描述</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <textarea rows="3" nz-input name="remark" [(ngModel)]="currentItem.remark"></textarea>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzFor="advice" nzRequired>审计建议</nz-form-label>
      <nz-form-control [nzSpan]="20"
        [nzValidateStatus]="advice.invalid && (advice.dirty || advice.touched) ? 'error' : ''">
        <textarea required rows="3" #advice="ngModel" nz-input name="advice"
          [(ngModel)]="currentItem.advice"></textarea>
        <nz-form-explain *ngIf="advice.invalid && (advice.dirty || advice.touched)">
          请填写问题描述
        </nz-form-explain>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzFor="problemType" nzRequired>问题类型</nz-form-label>
      <nz-form-control [nzSpan]="8"
        [nzValidateStatus]="problemType.invalid && (problemType.dirty || problemType.touched)? 'error' : ''">
        <app-dict-select required [dictCode]="'PROBLEM_TYPE'" nzAllowClear [placeHolder]="'请选择问题类型'"
          #problemType="ngModel" name="problemType" [(ngModel)]="currentItem.type">
        </app-dict-select>
        <nz-form-explain *ngIf="problemType.invalid &&(problemType.dirty || problemType.touched)">
          请选择问题类型
        </nz-form-explain>
      </nz-form-control>

      <nz-form-label [nzSpan]="4" nzFor="rectifyDepartmentId" nzRequired>整改部门</nz-form-label>
      <nz-form-control [nzSpan]="8" [nzValidateStatus]="
      rectifyDepartmentId.invalid &&
          (rectifyDepartmentId.dirty || rectifyDepartmentId.touched)
            ? 'error'
            : ''
        ">
        <nz-tree-select [nzNodes]="organizationTree" nzDefaultExpandAll nzShowSearch nzAllowClear="true"
          name="rectifyDepartmentId" [(ngModel)]="currentItem.rectifyDepartmentId"
          [nzDropdownStyle]="{ maxHeight: '280px' }" #rectifyDepartmentId="ngModel" required>
        </nz-tree-select>
        <nz-form-explain
          *ngIf="rectifyDepartmentId.invalid && (rectifyDepartmentId.dirty || rectifyDepartmentId.touched)">
          请选择子问题整改部门
        </nz-form-explain>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzFor="dutyUserId" nzRequired>整改负责人</nz-form-label>
      <nz-form-control [nzSpan]="8"
        [nzValidateStatus]="dutyUserId.invalid && (dutyUserId.dirty || dutyUserId.touched)? 'error': ''">
        <nz-select name="dutyUser" [(ngModel)]="currentItem.dutyUserId" style="width: 100%;" nzShowSearch="true"
          nzAllowClear="true" #dutyUserId="ngModel" required>
          <nz-option *ngFor="let option of dutyUserList" [nzLabel]="option.name" [nzValue]="option.id">
          </nz-option>
        </nz-select>
        <nz-form-explain *ngIf="dutyUserId.invalid && (dutyUserId.dirty || dutyUserId.touched)">
          请选择整改负责人
        </nz-form-explain>
      </nz-form-control>
    </nz-form-item>
  </form>
  <ng-template #formFooter>
    <button nz-button nzType="default" (click)="handleCancel()">取消</button>
    <button nz-button nzType="primary" [nzLoading]="loading" (click)="saveData()">
      确定
    </button>
  </ng-template>
</nz-modal>
